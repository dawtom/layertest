<!DOCTYPE html>

<html>

<head>

  <meta charset="utf-8">

  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

  <title>Intro to FeatureLayer - 4.9</title>


  <link rel="stylesheet" href="https://js.arcgis.com/4.9/esri/css/main.css">

  <script src="https://js.arcgis.com/4.9/"></script>


  <style>

    html,
    body,
    #viewDiv {

      padding: 0;

      margin: 0;

      height: 100%;

      width: 100%;

    }

    .esri-view-width-less-than-large .esri-popup__action-text {
      display: block !important; 
    }
  </style>


  <script>

    require([

        "esri/Map",

        "esri/views/MapView",

        "esri/layers/FeatureLayer",

        "esri/core/urlUtils",
            "esri/widgets/Popup"

      ],

      function (
        Map, MapView,
        FeatureLayer,
        urlUtils
      ) {

          var map = new Map({

              basemap: "topo"

          });



        var view = new MapView({

          container: "viewDiv",

          // extent: { // autocasts as new Extent()
          //
          //   xmin: -10000,
          //
          //   ymin: 10000,
          //
          //   xmax: -10000,
          //
          //   ymax: 10000,
          //
          //   spatialReference: 102100
          //
          // },
            map: map,
            center: [-118,34],
            scale: 1000000,

            // type: 'feature'

        });


          view.on("pointer-down", function(event){
              view.hitTest(event)
                  .then(function(response){
                      view.popup.open({
                          title: "Działka",
                          location: response.results[0].mapPoint,
                          content: "ID działki: " + response.results[0].graphic.attributes.OBJECTID + "/nCena działki: " + response.results[0].graphic.attributes.LS1_Sale_Amount
                      });

                  });
          });

        /********************

         * Add feature layer

         ********************/




        var i;
        var shift = 40000;
          for (i = 0; i < 320000; i += shift) {
              var featureLayer = new FeatureLayer({
                  url: "http://arcgis.epicland.com:6080/arcgis/rest/services/Test2/Service3/MapServer",
                  outFields: ["OBJECTID", "LS1_Sale_Amount", "CENTER_LAT", "CENTER_LON"]
              });
              // var j;
              // var defExpr = "OBJECTID = " + i;
              // for (j = i + 1; j < i + shift; j++) {
              //     defExpr += " OR OBJECTID = " + j;
              // }
              var ibig = i + shift;
              var defExpr = "OBJECTID > " + i + " AND OBJECTID < " + ibig + " AND CENTER_LAT > 33.806319 AND CENTER_LAT < 33.918435 AND CENTER_LON > -118.429350 AND CENTER_LON < -118.350764";
              // console.log(defExpr);
              featureLayer.definitionExpression = defExpr;
              map.layers.add(featureLayer);
          }
         /* var featureLayer = new FeatureLayer({
                url: "http://arcgis.epicland.com:6080/arcgis/rest/services/Test2/Service3/MapServer",
                outFields: ["OBJECTID", "LS1_Sale_Amount", "CENTER_LAT", "CENTER_LON"]
          });

          featureLayer.definitionExpression = "OBJECTID < 80000 AND CENTER_LAT > 33.806319 AND CENTER_LAT < 33.918435 AND CENTER_LON > -118.429350 AND CENTER_LON < -118.350764";
          map.layers.add(featureLayer)*/

      });

  </script>

</head>


<body>

<div id="viewDiv"></div>

</body>


</html>
